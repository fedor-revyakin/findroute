###  Система поиска маршрутов. Постановка задачи.
Помимо основной деятельности, современный вуз организует множество различных дополнительных лекций, семинаров, “дней открытых дверей” и других мероприятий, привлекающих существенное число заинтересованных слушателей, преподавателей, специалистов, посещающих его однократно и впервые. Т.е. университет является сегодня популярным местом, и необходимо предоставить простое средство по поиску нужной аудитории и способа прохода к ней всем, кто его посещает. Требуется система поиска маршрутов в здании. Данная система должна быть реализована в виде интернет-ресурса (веб-приложения). Предназначением системы является хранение описаний этажей здания, включая номера аудиторий и доступные пути перемещения по этажу и между этажами, а также графическое представление схем этажей. Приложение также должно уметь прокладывать маршрут по указанным начальной и конечной точкам и отображать пользователю пути прохождения на схеме этажа.

Приведенное описание задачи позволяет выделить функциональные возможности системы, представляющие собой высокоуровневое описание того, что должна делать система: 
1. Представление этажей здания с аудиториями и путями прохода к ним. 
2. Загрузка данных одного и более этажей. 
3. Определение кратчайшего пути от начальной до конечной точки, расположенных на любом этаже здания. 

Используя данный список, выполним построение диаграммы прецедентов для получения без деталей и подробностей представления о том, как будет использоваться система. 
![прецеденты](https://user-images.githubusercontent.com/59764396/72204089-3d2ee680-3485-11ea-84f1-b9423582879b.png)

  Функциональные возможности, сформулированные заказчиком, должны быть преобразованы в требования, необходимые для их реализации.  
  Для того, чтобы преобразовать в требования общую картину системы, полученную на основании диаграммы вариантов использования, необходимо проанализировать решаемую задачу, выполнить сбор и упорядочение актуальной информации о предметной области, составить глоссарий проекта.  
  Из требований примем, что каждому этажу соответствует экземпляр данных, описывающих представление этажа, состоящее только из совокупности доступных путей перемещения по нему. Кроме того, каждый этаж - это схема или план, т.е. графическое представление с указанием пути или без него. Таким образом, каждый этаж - это: 
- данные представления - файл, база данных или др. вид данных, содержащих описание путей перемещения по этажу. 
- представление этажа - все возможные пути перемещения по этажу, сформированные системой на основе данных представления. 
- схема - графическое изображение этажа. 

  Для моделирования возможных перемещений применяются графы. Данная математическая модель находит применение во многих вычислительных приложениях. Она используется для описания попарных соединений между элементами. На ее основе разработаны многие полезные алгоритмы, в том числе для решения задачи поиска кратчайшей цепочки соединений между двумя указанными элементами.
  Граф - это множество вершин и коллекция ребер, каждое из которых соединяет пару вершин.    В разрабатываемой системе в качестве вершин выступают аудитории, а в качестве ребер - отрезки соединяющих прямых.
  
![схема с доступными путями перемещения](https://user-images.githubusercontent.com/59764396/72204330-88e28f80-3487-11ea-8de8-8cda1bfb37f6.png)

Из приведенного рисунка видно, что при передвижении по возможному маршруту направление перехода от одной вершины к другой может быть любым. 

  Согласно постановке задачи, маршрут между двумя точками должен быть кратчайшим. Если пренебречь действительными расстояниями между двумя вершинами, то протяженность маршрута можно оценить только по количеству вершин, соединяющих отрезки пути. Тогда возможен случай, при котором два пути, действительная протяженность которых существенно отличается, будут составлены из совпадающего количества вершин. Это приведет к тому, что при сравнении они окажутся равными и в качестве кратчайшего может быть выбран любой, что недопустимо. Т.е. при отсутствии указания весов ребер графа, в системе нельзя выполнить корректное сравнение нескольких маршрутов.  
  Таким образом, в модели графа для описания этажа здания с каждым соединением должен быть связан некоторый вес, при этом направление соединений не имеет значения. Т.е. в системе применяется ***модель неориентированного взвешенного графа.***
  
  Как следует из постановки задачи, каждый клиент системы, выступающий в роли посетителя, указывает действительные объекты для получения маршрута. Совокупность таких объектов каждого этажа составляет описание, доступное пользователю для выбора начальной и конечной точек маршрута. Основой такого описания являются аудитории, а также лестницы этажа, т.к. они могут служить начальной или конечной точкой маршрута. Для работы системы необходимо, чтобы в описании этажа каждому объекту соответствовала вершина, т.е. выполнялась связь действительных объектов с элементами модели. 
 Глоссарий проекта обеспечивает словарь ключевых терминов и определений. Кроме данных представления, представления этажа и схемы, определенных выше, глоссарий дополнен следующими терминами: 
- действительный объект - конкретное место на этаже, которое может быть началом или концом маршрута (аудитория, лестница, кафедра, читальный зал и др.) 
- описание этажа - соответствие действительных объектов вершинам графа на схеме этажа, составленное системой на основе файла описания этажа. 
- маршрут - кратчайший путь между двумя действительными объектами.

  Составим список основных функциональных требований. Данный список может быть дополнен при дальнейшем анализе: 
- Система должна выполнять загрузку описания и представления всех этажей здания при запуске. 
- Система должна составлять маршрут между двумя действительными объектами в многоэтажном здании. 
- Система должна отображать посетителю маршрут в графическом виде на схеме этажа.

### Детализация прецедентов
После создания диаграммы прецедентов и выполнения предварительного анализа необходимо точно определить каждый прецедент.

![прецедент 1](https://user-images.githubusercontent.com/59764396/72205990-2d6dcd00-349a-11ea-83c3-1b04f9362482.png)

![прецедент 2](https://user-images.githubusercontent.com/59764396/72205992-3199ea80-349a-11ea-8aba-e56113419073.png)

  Детализация альтернативных потоков: 
  
![альтернативный поток 2 1](https://user-images.githubusercontent.com/59764396/72205993-378fcb80-349a-11ea-9f5e-276987da6f89.png)
  
![альтернативный поток 2 2](https://user-images.githubusercontent.com/59764396/72205994-3a8abc00-349a-11ea-95e0-82e0c933da7c.png)

### Аналитическая модель.

  После получения модели прецедентов необходимо создать аналитическую модель системы. Основной целью при этом является иллюстрация поведения системы как совокупности взаимодействующих объектов на высоком уровне абстракции без деталей реализации данного поведения. Аналитическая модель должна представлять собой краткое, простое описание структуры и поведения системы. Построение данной модели начинают с выявления классов анализа. Данные классы моделируют важные аспекты и ключевые понятия предметной области. 

  При выявлении классов анализа используется весь объем относящейся к системе информации. Применяя к документации процедуру анализа существительное/глагол, для первого прецедента получили классы: Здание, Этаж, Представление Этажа, Описание Этажа. Используя дополнительный метод выявления классов путем применения стереотипов, получили также граничный класс Загрузчик. Из второго прецедента получены следующие классы: Составитель маршрута, Маршрут, а также граничный класс  BrowserView, представляющий весь пользовательский интерфейс. Аналитическая модель в первом приближении показана на рисунке
  
![аналитическая модель](https://user-images.githubusercontent.com/59764396/72206125-462ab280-349b-11ea-8c92-14caa1e3243f.png)

### Реализация прецедента "Получение инструкций". 

  Целью выполнения данного прецедента является отображение клиенту Маршрута, полученного при взаимодействии классов анализа Facility и RouteController. Чтобы абстракция RouteController выполняла задачу на своем уровне, выделим простые абстракции, которые необходимы для составления любого маршрута в системе: получение начальной и конечной точки, получение маршрута и подготовка его к отображению. Предполагая, что каждой из них должен соответствовать класс, определим обязанности более конкретно:
- ParseInputData – разбор данных, введенных пользователем. Определение номеров вершин (пункты 2.2 - 2.4 прецедента "Получение маршрута"). 
- RouteCreator - получение из представлений этажей коллекции ребер, представляющих кратчайший маршрут (п. 3 прецедента). 
- Guide - преобразование коллекции номеров вершин или создание на ее основе новых объектов для отображения маршрута пользователю. 

Рассмотрим подробнее класс RouteCreator. Каждый маршрут, полученный с его помощью, должен содержать: 
1. начальную вершину 
2. конечную вершину 
3. кратчайший путь от начальной до конечной вершины 

  Выполнение прецедента Загрузка данных обеспечивает систему представлением каждого отдельного этажа здания. Это позволяет ввести класс для выполнения ключевой операции - составления кратчайшего пути между двумя вершинами на одном этаже. Примем имя данного класса - CreatorShortestPath. 
  Чтобы выполнить требования, система должна также прокладывать маршрут между вершинами, расположенными на разных этажах. Рассмотрим список элементов такого маршрута: 

1. начальная вершина на этаже S 
2. конечная вершина на этаже F 
3. кратчайший маршрут, состоящий из:
    - 3.1 пути от начальной вершины до одной из лестниц этажа S
    - 3.2 пути от лестницы этажа S до лестницы этажа F
    - 3.3 пути от одной из лестниц этажа F до конечной вершины
    
![маршрут между этажами](https://user-images.githubusercontent.com/59764396/72206363-b0dced80-349d-11ea-8eb4-d0f2650b1178.png)

  Т.к. для представления перемещений между этажами используется та же модель, что и при описании перемещений по этажу, поиск кратчайшего пути между лестницами на разных этажах (п 3.2) может быть поручен классу CreatorShortestPath.
  
  Также необходимо ввести абстракцию, включающую в себя требования к маршруту и операции, позволяющие приступить к его построению.
  
  ![требования](https://user-images.githubusercontent.com/59764396/72206375-1335ee00-349e-11ea-9a9e-a657ea382faf.png)
  
  Указанные операции класса анализа RouteRequirements являются приблизительными формулировками его обязанностей и могут уточняться позже. В качестве основных функций выделены: запрос возможности построения маршрута (isAvailableRoute), получение информации об ошибках в данных (getCause), запрос вида маршрута (getKindRoute). 
  Примем в качестве результата выполнения абстракцией ParseInputData ее основной обязанности создание экземпляра класса требований к маршруту RouteRequirements. Данный экземпляр потребуется также классу RouteController для определения начальных данных при составлении маршрута.
  
  
  Условием для завершения прецедента “Получение инструкций” является отображение посетителю маршрута в графическом виде. Введем абстракцию IDisplayElement графического элемента маршрута для инкапсуляции данных, необходимых при выводе элемента на экран с помощью операции toDisplay(). Тогда класс Guide должен преобразовать коллекцию объектов IStepCommand, полученную из клиентского запроса, или создать на ее основе новую коллекцию графических элементов IDisplayElement, которые затем должны быть отображены посетителю. 
  
  ### Получение проектных классов.
  
  Основной целью анализа было построение логической модели системы, отражающей функциональность, которою должна предоставлять система для удовлетворения требований пользователя. Цель проектирования - определить в полном объеме, как будет реализовываться эта функциональность.  
  
  Сначала необходимо применить процесс уточнения к классу RouteController. В качестве контроллера данный класс определяет способ построения маршрута с помощью фабричного метода. Основания для выбора конкретной реализации шаблона RouteCreator  содержатся в требованиях - экземпляре класса RouteRequirements. В зависимости от деталей маршрута фабричный метод предоставит одну из пяти реализаций абстрактного класса RouteCreator, каждая из которых ответственна за один из видов маршрута: FloorRouteCreator, StairRouteCreator, EntireCompositeRoute, StartCompositeRoute, FinishCompositeRoute. Детализация класса RouteController, а также класса FloorRouteCreator показана на рисунке.
  
  ![проектный класс FloorRouteCreator](https://user-images.githubusercontent.com/59764396/72206497-bc311880-349f-11ea-9234-48c86b7f8328.png)
  
![проектный класс RouteCOntroller](https://user-images.githubusercontent.com/59764396/72206500-bf2c0900-349f-11ea-9d39-1db4d0abfc37.png)

![проектный класс Guide](https://user-images.githubusercontent.com/59764396/72208109-26ea5000-34b0-11ea-93d9-31120d5b954e.png)

  Т.к. абстракция ребра выбрана в качестве элементарного отрезка маршрута, то основной обязанностью каждой реализации RouteCreator является получение и передача контроллеру коллекции ребер, представляющей маршрут. Но использовать данную коллекцию для отображения инструкций нельзя. Полученная схема не сообщит посетителю о том, где начинается и заканчивается маршрут, а также о начале движения по лестнице или вступлении на этаж после движения по ней. Чтобы маршрут был не только корректным, но и понятным посетителю, вводятся абстракции Guide, StepCommandCreator, IStepCommand.
  
  ![паттерны Команда и Состояние](https://user-images.githubusercontent.com/59764396/72207813-4e8be900-34ad-11ea-9507-5c1199f4d5e0.png)
  
  Диаграмма классов, представленная на рисунке выше, описывает совместное применение паттернов “Команда” и “Состояние”. Класс StepCommandCreator используется реализациями RouteCreator для создания объектов команд FloorStep, StairStep, добавляющих каждому ребру описание участка пути с точки зрения посетителя. Коллекция таких команд, объединенная под интерфейсом IStepCommand, возвращается контроллеру. Такая архитектура способствует отделению класса RouteController от класса-исполнителя Guide и деталей маршрута. Чтобы получить коллекцию объектов, готовых к отображению, достаточно выполнить каждую команду вызовом метода nextStep(). 

Для иллюстрации того, как объекты команд позволяют классу Guide создать результирующую коллекцию,построена диаграмма состояний

![диаграмма состояний Guide](https://user-images.githubusercontent.com/59764396/72207990-ba228600-34ae-11ea-8e1a-42d5ddcdf584.png)

Детализация классов состояний StartRouteStatus, FloorRouteStatus, StairRouteStatus приведена на предыдущем рисунке.

  
